function apiPost(b,m,a,k){b=AnyBalance.requestPost(b,{csrf_token:csrf,track_id:track_id},addHeaders({"X-Requested-With":"XMLHttpRequest",Origin:baseurl,Referer:referer}));json=getJson(b);if("ok"!==json.status)throw AnyBalance.trace(b),b=json.errors.join("; ")||json.error.join("; "),new AnyBalance.Error("Пароль не принят: "+b,null,/not_matched/.test(b));}
function loginYandex(b,m,a,k,n){function c(f,g,r,q){f=AnyBalance.requestPost("https://passport.yandex.ru/"+f,g,addHeaders({"X-Requested-With":"XMLHttpRequest",Origin:"https://passport.yandex.ru",Referer:p}));g=getJson(f);if("ok"!==g.status&&(g.error||g.errors&&"captcha.required"!==g.errors[0]))throw AnyBalance.trace(f),f=g.errors.join("; ")||g.error.join("; "),new AnyBalance.Error(r+": "+f,null,q&&q.test(f));return g}function t(){AnyBalance.trace("Потребовался ввод текстовой капчи");json=c("registration-validations/textcaptcha",
{csrf_token:d,track_id:e,language:"ru",scale_factor:3},"Запрос на отправку капчи не принят");var f=AnyBalance.requestGet(json.image_url,g_headers),g=json.key;f=AnyBalance.retrieveCode("В некоторых случаях Яндекс использует защиту от роботов в виде текстовой капчи.\nПожалуйста, введите символы с картинки",f,{time:18E4});json=c("registration-validations/checkHuman",{csrf_token:d,track_id:e,answer:f,key:g},"Запрос на проверку ответа не принят")}var h={};n&&(h.origin=n);k&&(h.retpath=k);var p="https://passport.yandex.ru/auth/?"+
createUrlEncodedParams(h);a||(a=AnyBalance.requestGet(p,g_headers));var d=getParam(a,/<input[^>]+name="csrf_token"[^>]*value="([^"]*)/i,replaceHtmlEntities);h=getParam(a,/process_uuid=([^&"]*)/i,replaceHtmlEntities,decodeURIComponent);json=c("registration-validations/auth/multi_step/start",{csrf_token:d,login:b,process_uuid:h,retpath:k,origin:n},"Вход не может быть выполнен. Сайт изменен?",/userNotFound|prohibitedsymbols/);if(!json.can_authorize)throw AnyBalance.trace(a),new AnyBalance.Error("Этот логин не может быть авторизован (неверный логин)",
null,!0);var e=json.track_id;json=c("registration-validations/auth/multi_step/commit_password",{csrf_token:d,track_id:e,password:m,retpath:k},"Пароль не принят",/not_matched/);json.errors&&"captcha.required"==json.errors[0]&&(t(),json=c("registration-validations/auth/multi_step/commit_password",{csrf_token:d,track_id:e,password:m,retpath:k},"Пароль не принят",/not_matched/));if("change_password"==json.state)throw AnyBalance.trace("Потребовалась смена пароля"),new AnyBalance.Error("Яндекс требует сменить пароль. Пожалуйста, перейдите на страницу авторизации https://passport.yandex.ru/auth/welcome через браузер, смените пароль и введите новый пароль в настройки провайдера",
null,!0);if("auth_challenge"==json.state&&(AnyBalance.trace("Потребовалась дополнительная проверка входа"),json=c("registration-validations/auth/challenge/submit",{csrf_token:d,track_id:e},"Запрос на проверку входа не принят"),b=json.challenge.challengeType,m=json.challenge.phoneId,n=json.challenge.hint,"mobile_id"==b&&(AnyBalance.trace("Требуется подтверждение через мобильный Яндекс"),1==json.challenge.isSms2faChallenge?(json=c("registration-validations/auth/challenge/send_push",{csrf_token:d,track_id:e},
"Запрос на отправку уведомления не принят"),h=AnyBalance.retrieveCode("Пожалуйста, введите код из уведомления, отправленного в мобильное приложение Яндекс на вашем устройстве",null,{inputType:"number",time:18E4}),json=c("registration-validations/auth/challenge/commit",{csrf_token:d,track_id:e,challenge:"push_2fa",answer:h},"Ошибка подтверждения входа")):(AnyBalance.trace("Требуемое подтверждение не поддерживается"),b="phone_confirmation")),!/auth\/challenge\/commit/i.test(AnyBalance.getLastUrl())))if("phone_confirmation"==
b){AnyBalance.trace("Требуется подтверждение по телефону");json=c("registration-validations/auth/validate_phone_by_id",{csrf_token:d,track_id:e,phoneId:m},"Запрос на валидацию не принят");if(0==json.valid_for_flash_call&&0==json.valid_for_call){AnyBalance.trace("Требуется подтверждение с помощью кода из SMS");var l="by_sms"}else if(1==json.valid_for_flash_call&&1==json.valid_for_call)AnyBalance.trace("Требуется подтверждение с помощью входящего звонка"),l="by_flash_call";else if(!json.valid_for_flash_call&&
!json.valid_for_call)throw AnyBalance.trace(a),new AnyBalance.Error("Требуемое подтверждение не поддерживается");json=c("registration-validations/phone-confirm-code-submit",{csrf_token:d,track_id:e,phone_id:m,confirm_method:l,isCodeWithFormat:!0},"Запрос на отправку кода не принят");a=json.global_sms_id?AnyBalance.retrieveCode("Пожалуйста, введите код из "+json.code_length+" цифр из SMS, отправленного на ваш номер "+json.number.masked_international,null,{inputType:"number",time:18E4}):AnyBalance.retrieveCode("Пожалуйста, введите последние "+
json.code_length+" цифры номера телефона из звонка, поступившего на ваш номер "+json.number.masked_international,null,{inputType:"number",time:18E4});json=c("registration-validations/phone-confirm-code",{csrf_token:d,track_id:e,code:a},"Запрос на подтверждение кода не принят");json=c("registration-validations/auth/challenge/commit",{csrf_token:d,track_id:e,challenge:b},"Ошибка подтверждения входа")}else if("push_2fa"==b)AnyBalance.trace("Требуется подтверждение через мобильный Яндекс"),json=c("registration-validations/auth/challenge/send_push",
{csrf_token:d,track_id:e},"Запрос на отправку уведомления не принят"),h=AnyBalance.retrieveCode("Пожалуйста, введите код из уведомления, отправленного в мобильное приложение Яндекс на вашем устройстве",null,{inputType:"number",time:18E4}),json=c("registration-validations/auth/challenge/commit",{csrf_token:d,track_id:e,challenge:b,answer:h},"Ошибка подтверждения входа");else if("question"==b)AnyBalance.trace("Требуется ответ на контрольный вопрос"),h=AnyBalance.retrieveCode("Пожалуйста, введите ответ на контрольный вопрос:\n\n"+
n,null,{time:18E4}),json=c("registration-validations/auth/challenge/commit",{csrf_token:d,track_id:e,challenge:b,answer:h},"Ошибка подтверждения входа");else throw AnyBalance.trace(a),new AnyBalance.Error("Затребованный тип проверки не поддерживется: "+b);a=AnyBalance.requestGet("https://passport.yandex.ru/auth/finish/?"+createUrlEncodedParams({track_id:e,retpath:k}),addHeaders({Referer:p}));if(/host/i.test(a)&&/goal/i.test(a))l=getJsonObject(a,/var\s*it\s*=\s*/),l=JSON.stringify(l),k=getParam(l,
/"host":"([^"]*)/i,replaceHtmlEntities,decodeURIComponent),l=getParam(l,/"goal":"([^"]*)/i,replaceHtmlEntities,decodeURIComponent),a=getParam(a,/element2\.value\s?=\s?'([^']*)/i,replaceHtmlEntities,decodeURIComponent),a=AnyBalance.requestPost(k,{goal:l,container:a},addHeaders({"Content-Type":"application/x-www-form-urlencoded",Origin:"https://sso.passport.yandex.ru",Referer:"https://sso.passport.yandex.ru/"}));else throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти форму входа. Сайт изменен?");
return a};
