function apiPost(b,l,a,g){b=AnyBalance.requestPost(b,{csrf_token:csrf,track_id:track_id},addHeaders({"X-Requested-With":"XMLHttpRequest",Origin:baseurl,Referer:referer}));json=getJson(b);if("ok"!==json.status)throw AnyBalance.trace(b),b=json.errors.join("; "),new AnyBalance.Error("Пароль не принят: "+b,null,/not_matched/.test(b));}
function loginYandex(b,l,a,g,n){function c(f,k,r,q){f=AnyBalance.requestPost("https://passport.yandex.ru/"+f,k,addHeaders({"X-Requested-With":"XMLHttpRequest",Origin:"https://passport.yandex.ru",Referer:p}));k=getJson(f);if("ok"!==k.status&&"captcha.required"!==k.errors[0])throw AnyBalance.trace(f),f=k.errors.join("; "),new AnyBalance.Error(r+": "+f,null,q&&q.test(f));return k}function t(){AnyBalance.trace("Потребовался ввод текстовой капчи");json=c("registration-validations/textcaptcha",{csrf_token:d,
track_id:e,language:"ru",scale_factor:3},"Запрос на отправку капчи не принят");var f=AnyBalance.requestGet(json.image_url,g_headers),k=json.key;f=AnyBalance.retrieveCode("В некоторых случаях Яндекс использует защиту от роботов в виде текстовой капчи.\nПожалуйста, введите символы с картинки",f,{time:18E4});json=c("registration-validations/checkHuman",{csrf_token:d,track_id:e,answer:f,key:k},"Запрос на проверку ответа не принят")}var m={};n&&(m.origin=n);g&&(m.retpath=g);var p="https://passport.yandex.ru/auth/?"+
createUrlEncodedParams(m);a||(a=AnyBalance.requestGet(p,g_headers));var d=getParam(a,/<input[^>]+name="csrf_token"[^>]*value="([^"]*)/i,replaceHtmlEntities);m=getParam(a,/process_uuid=([^&"]*)/i,replaceHtmlEntities,decodeURIComponent);json=c("registration-validations/auth/multi_step/start",{csrf_token:d,login:b,process_uuid:m,retpath:g,origin:n},"Вход не может быть выполнен. Сайт изменен?",/userNotFound|prohibitedsymbols/);if(!json.can_authorize)throw AnyBalance.trace(a),new AnyBalance.Error("Этот логин не может быть авторизован (неверный логин)",
null,!0);var e=json.track_id;json=c("registration-validations/auth/multi_step/commit_password",{csrf_token:d,track_id:e,password:l,retpath:g},"Пароль не принят",/not_matched/);json.errors&&"captcha.required"===json.errors[0]&&(t(),json=c("registration-validations/auth/multi_step/commit_password",{csrf_token:d,track_id:e,password:l,retpath:g},"Пароль не принят",/not_matched/));if("change_password"===json.state)throw AnyBalance.trace("Потребовалась смена пароля"),new AnyBalance.Error("Яндекс требует сменить пароль. Пожалуйста, перейдите на страницу авторизации https://passport.yandex.ru/auth/welcome через браузер, смените пароль и введите новый пароль в настройки провайдера",
null,!0);if("auth_challenge"===json.state)if(AnyBalance.trace("Потребовалась дополнительная проверка входа"),json=c("registration-validations/auth/challenge/submit",{csrf_token:d,track_id:e},"Запрос на проверку входа не принят"),b=json.challenge.challengeType,"phone_confirmation"===b){AnyBalance.trace("Требуется подтверждение по телефону");l=json.challenge.phoneId;json=c("registration-validations/auth/validate_phone_by_id",{csrf_token:d,track_id:e,phoneId:l},"Запрос на валидацию не принят");if(!1===
json.valid_for_flash_call&&!1===json.valid_for_call){AnyBalance.trace("Требуется подтверждение с помощью кода из SMS");var h="by_sms"}else if(!0===json.valid_for_flash_call&&!0===json.valid_for_call)AnyBalance.trace("Требуется подтверждение с помощью входящего звонка"),h="by_flash_call";else if(!json.valid_for_flash_call&&!json.valid_for_call)throw AnyBalance.trace(a),new AnyBalance.Error("Требуемое подтверждение не поддерживается");json=c("registration-validations/phone-confirm-code-submit",{csrf_token:d,
track_id:e,phone_id:l,confirm_method:h,isCodeWithFormat:!0},"Запрос на отправку кода не принят");a=json.global_sms_id?AnyBalance.retrieveCode("Пожалуйста, введите код из "+json.code_length+" цифр из SMS, отправленного на ваш номер "+json.number.masked_international,null,{inputType:"number",time:18E4}):AnyBalance.retrieveCode("Пожалуйста, введите последние "+json.code_length+" цифры номера телефона из звонка, поступившего на ваш номер "+json.number.masked_international,null,{inputType:"number",time:18E4});
json=c("registration-validations/phone-confirm-code",{csrf_token:d,track_id:e,code:a},"Запрос на подтверждение кода не принят");json=c("registration-validations/auth/challenge/commit",{csrf_token:d,track_id:e,challenge:b},"Ошибка подтверждения входа")}else if("push_2fa"===b)AnyBalance.trace("Требуется подтверждение через мобильный Яндекс"),json=c("registration-validations/auth/challenge/send_push",{csrf_token:d,track_id:e},"Запрос на отправку уведомления не принят"),a=AnyBalance.retrieveCode("Пожалуйста, введите код из уведомления, отправленного в мобильное приложение Яндекс на вашем устройстве",
null,{inputType:"number",time:18E4}),json=c("registration-validations/auth/challenge/commit",{csrf_token:d,track_id:e,challenge:b,answer:a},"Ошибка подтверждения входа");else throw AnyBalance.trace(a),new AnyBalance.Error("Затребованный тип проверки не поддерживется: "+b);a=AnyBalance.requestGet("https://passport.yandex.ru/auth/finish/?"+createUrlEncodedParams({track_id:e,retpath:g}),addHeaders({Referer:p}));if(/host/i.test(a)&&/goal/i.test(a))h=getJsonObject(a,/var\s*it\s*=\s*/),h=JSON.stringify(h),
g=getParam(h,/"host":"([^"]*)/i,replaceHtmlEntities,decodeURIComponent),h=getParam(h,/"goal":"([^"]*)/i,replaceHtmlEntities,decodeURIComponent),a=getParam(a,/element2\.value\s?=\s?'([^']*)/i,replaceHtmlEntities,decodeURIComponent),a=AnyBalance.requestPost(g,{goal:h,container:a},addHeaders({"Content-Type":"application/x-www-form-urlencoded",Origin:"https://sso.passport.yandex.ru",Referer:"https://sso.passport.yandex.ru/"}));else throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти форму входа. Сайт изменен?");
return a};
