var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(e){return e.raw=e};$jscomp.createTemplateTagFirstArgWithRaw=function(e,a){e.raw=a;return e};
var BrowserAPI=function(){var e=function(a){this.options=a;this.headerMatchCounts=[]};e.prototype.requestAPI=function(a,b){b=b?AnyBalance.requestPost("http://192.168.0.118:4024/"+a,JSON.stringify(b),{"Content-Type":"application/json"}):AnyBalance.requestGet("http://192.168.0.118:4024/"+a+(0<=a.indexOf("?")?"&":"?")+"_="+ +new Date);var c=JSON.parse(b);if("ok"!==c.status)throw AnyBalance.trace(b),new AnyBalance.Error("Ошибка browser api ("+a+"): "+c.message);return c};e.prototype.open=function(a){var b=
this.requestAPI("base/open",{userAgent:this.options.userAgent,url:a,rules:this.options.rules});AnyBalance.trace("Opening page "+a+": "+b.page);return b};e.prototype.waitForLoad=function(a,b){b=0;do{++b;AnyBalance.sleep(3E3);var c=this.requestAPI("base/status?page="+a);AnyBalance.trace("Loading status of page "+a+": "+c.loadStatus+" (попытка "+b+")");if(c.pendingRequests&&0<c.pendingRequests.length)for(var p=0;p<c.pendingRequests.length;++p){var f=c.pendingRequests[p],m=[],q;for(q in f.headers)for(var h=
f.headers[q].split("\n"),d=0;d<h.length;++d)m.push([q,h[d]]);h={};if(this.options.additionalRequestHeaders)for(d=0;d<this.options.additionalRequestHeaders.length;++d){var g=this.options.additionalRequestHeaders[d];if(!g.url||g.url.test(f.url)){var k=this.headerMatchCounts;if(g.maxCount||(k[d]||0)<g.maxCount){h=g.headers||{};g.maxCount&&(k[d]=(k[d]||0)+1);break}}}m=AnyBalance.requestPost(f.url,f.body,addHeaders(m,h),{HTTP_METHOD:f.method});h=AnyBalance.getLastResponseParameters();d={};g=void 0;for(k=
0;k<h.headers.length;++k){var n=h.headers[k],l=n[0].toLowerCase();0<=["transfer-encoding","content-encoding"].indexOf(l)||("content-length"===l&&(n[1]=""+unescape(encodeURIComponent(m||"")).length),d[l]=void 0===d[l]?n[1]:d[l]+("\n"+n[1]),"content-type"===l&&(g=n[1]))}f={id:f.id,page:a,r:{status:AnyBalance.getLastStatusCode(),headers:d,contentType:g,body:m}};this.requestAPI("base/response",f)}else if("load"===c.loadStatus)break}while(15>b);if("load"!==c.loadStatus)throw new AnyBalance.Error("Waiting for page "+
a+" loading timeout!");};e.prototype.content=function(a){return this.requestAPI("base/content?page="+a)};e.prototype.cookies=function(a,b){b&&(Array.isArray(b)||(b=[b]));return this.requestAPI("base/cookies",{page:a,urls:b})};e.prototype.close=function(a){return this.requestAPI("base/close",{page:a})};e.useCookies=function(a){for(var b=0;b<a.length;++b){var c=a[b];AnyBalance.setCookie(c.domain,c.name,c.value,c)}};return e}();
